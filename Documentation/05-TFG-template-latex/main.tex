\documentclass[10pt,a4paper,twocolumn,twoside]{article}
\usepackage[utf8]{inputenc}
\usepackage[catalan]{babel}
\usepackage{multicol}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{times}
\usepackage{titlesec}
\usepackage{multirow}
\usepackage{lettrine}
\usepackage[top=2cm, bottom=1.5cm, left=2cm, right=2cm]{geometry}
\usepackage[figurename=Fig.,tablename=TAULA]{caption}

\usepackage{biblatex}
\addbibresource{ref.bib}

\captionsetup[table]{textfont=sc}

\author{\LARGE\sffamily Christian Espinosa Reboredo}
\title{\Huge{\sffamily Recognition of cognitive states from EEG data}}
\date{}

\newcommand\blfootnote[1]{%
  \begingroup
  \renewcommand\thefootnote{}\footnote{#1}%
  \addtocounter{footnote}{-1}%
  \endgroup
}

%
%\large\bfseries\sffamily
\titleformat{\section}
{\large\sffamily\scshape\bfseries}
{\textbf{\thesection}}{1em}{}

\begin{document}
\nocite{*}
\fancyhead[LO]{\scriptsize AUTOR: TÍTOL DEL TREBALL}
\fancyhead[RO]{\thepage}
\fancyhead[LE]{\thepage}
\fancyhead[RE]{\scriptsize EE/UAB TFG INFORMÀTICA: TÍTOL (ABREUJAT SI ÉS MOLT LLARG)}

\fancyfoot[CO,CE]{}

\fancypagestyle{primerapagina}
{
   \fancyhf{}
   \fancyhead[L]{\scriptsize TFG EN ENGINYERIA INFORMÀTICA, ESCOLA D'ENGINYERIA (EE), UNIVERSITAT AUTÒNOMA DE BARCELONA (UAB)}
   \fancyfoot[C]{\scriptsize ``Mes'' de 20xx, Escola d'Enginyeria (UAB)}
}

%\lhead{\thepage}
%\chead{}
%\rhead{\tiny EE/UAB TFG INFORMÀTICA: TÍTOL (ABREUJAT SI ÉS MOLT LLARG)}
%\lhead{ EE/UAB \thepage}
%\lfoot{}
%\cfoot{\tiny{February 2015, Escola d'Enginyeria (UAB)}}
%\rfoot{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\pagestyle{fancy}

%\thispagestyle{myheadings}
\twocolumn[\begin{@twocolumnfalse}

%\vspace*{-1cm}{\scriptsize TFG EN ENGINYERIA INFORMÀTICA, ESCOLA D'ENGINYERIA (EE), UNIVERSITAT AUTÒNOMA DE BARCELONA (UAB)}

\maketitle

\thispagestyle{primerapagina}
%\twocolumn[\begin{@twocolumnfalse}
%\maketitle
%\begin{abstract}
\begin{center}
\parbox{0.915\textwidth}
{\sffamily
%\textbf{Resum--}

%\end{abstract}
%\bigskip
%\begin{abstract}
%\bigskip
%\\
\textbf{Abstract--}An electroencephalogram (EEG) is a test that detects electrical activity of the brain. Since 
1924 this procedure has been done countless times to obtain brain activity. This paper tries to go a step further 
to understand electroencephalography better using deep learning algorithms. The data used in this paper is a public 
dataset CHB-MIT\cite{goldberger2000physiobank} of recordings of paediatric subjects with intractable seizures. Different methods of data management 
are done and documented to make the most of the algorithms used. The objective is to train an algorithm to acknowledge 
when the subject is having a seizure.
\\
\\
\textbf{Keywords-- }electroencephalogram, deep learning, brain activity, classification, EEG analysis\\
}

\bigskip

{\vrule depth 0pt height 0.5pt width 4cm\hspace{7.5pt}%
\raisebox{-3.5pt}{\fontfamily{pzd}\fontencoding{U}\fontseries{m}\fontshape{n}\fontsize{11}{12}\selectfont\char70}%
\hspace{7.5pt}\vrule depth 0pt height 0.5pt width 4cm\relax}

\end{center}

\bigskip
%\end{abstract}
\end{@twocolumnfalse}]

\blfootnote{$\bullet$ E-mail de contacte: 1459024 @uab.cat}
\blfootnote{$\bullet$ Menció realitzada: Computació }
\blfootnote{$\bullet$ Treball tutoritzat per: Aura Hernández Sabaté (Ciencies de la Computació)}
\blfootnote{$\bullet$ Curs 2021/22}

\section{Introduction}

\lettrine[lines=3]{A}{n} epileptic seizure is a period of symptoms due to abnormally excessive or synchronous neuronal activity in the brain. This can cause different effects like uncontrolled shaking movements involving much of the body, parts of the body or subtle momentary loss of awareness. In order to understand this issue, it is important to understand how neurons work and interact with each other to conserve what we call consciousness represented as brain activity and brainwaves. 
\\
Neural oscillations are rhythmic or repetitive patterns of neural activity in the central nervous system which can be driven by mechanisms within individual neurons or by interactions. Since 1824 neural oscillations have been observed, fifty years later intrinsic oscillatory behaviour was encountered in vertebrate neurons, but the purpose of these is yet to be fully understood.
\\
In order to understand better brain activity in this TFG tries to dig deeper using new technology like deep learning to try to understand what humans are incapable of doing. First of all, it will be needed an inside view on how the brain works to have a hint on how to extract or intercept information from the neurons to process externally in a computer as well as a view on how deep learning algorithm’s function and get results from data, because it’s the best way to process and get the most out of it. Afterwards an insight of previous papers is given to set a view point on how research has been made up until this point. A well-known database (CHB-MIT)\cite{goldberger2000physiobank} is introduced of encephalograms collected from 23 subject with interactable seizures that has been used in previous research.
\\
Once everything is acknowledged objectives of in this TFG are settled for further research on this issue. First of all, data planning and different treatment procedures are important to see how algorithms behave giving better or worse results, as well as which algorithm architectures are better to process EEG data. Finally, once all the research is done the classifier is to be expected to classify moments where seizures occur on the patients in a given moment.
\\

\subsection{Dataset}
\leavevmode\\
The dataset\cite{goldberger2000physiobank} is data collected from the Children’s Hospital Boston, consisting in EEG recordings of subjects with intractable seizures. The folders classify in 23 cases from 22 subjects (case chb21 and chb1 are the same but 1.5 years apart). The subject’s personal information gender and age is in a separate file called SUBJECT-INFO added in this paper as subject\_info.csv.
\\
Each case contains between 9 and 42 .edf files. There are .edf files of EEG signals without seizures and others with recordings of seizures, these defined in RECORDS-WITH-SEIZURES. The files with seizures have the extension .edf.seizures which disables the possibility of accessing the file with a normal edf reader library.
\\
Most cases have 1 hour of EEG recordings, but some have 1 to 4 hours depending on the case, split between 9 to 42 edf recordings, recorded at 256Hz in 16 bit resolution.
\\

\input{related_work.tex}


\section{Objectives}
\label{sec-objectives}
There are two main objectives in this TFG. The first objective is to find the best way to treat and analyse before feeding it to the deep learning algorithms. For example, as a continuous stream of sequence, dividing data per subject…  Or trying different test/train strategies such as leave one out, 50/50… The second main objective is to try to find which algorithms architectures have better results. There are different models offered by the research group IAM from the CVC.
\\
To fulfil the objectives is crucial to define smaller objectives to make work easier. Within the first objective there are several important parts. 
\\
\begin{itemize}
  \item Raw data must be readable, as the data base CHB-MIT\cite{goldberger2000physiobank} is in European Data Format (EDF), a standard file format designed for exchange and storage of medical time series, so all files in the dataset are “.edf”. A script has been programmed to save .edf files into .parquet format.
  \item Setting different functions to filter data making sure data is okey and fits certain constraints. 
  \item Get the labelling data, to have a ground truth from the recorded data. This part is essential to understand if the model works as expected.
  \item Define different functions to define how data enters the model to be trained. There are many ways information can be extracted from data. 
\end{itemize}
\leavevmode\\
The next objective after obtaining data is to use different models provided by the research group to IAM:
\\
\begin{itemize}
  \item Each model needs to be configured to accept the dimensionality of the data fed to it.
  \item Work different models to choose what models give better answers form input data.
  \item After all the models results, an overview is done to understand the results and conclude the best way to treat this database, for further investigation.
\end{itemize}
\leavevmode\\

\section{Tasks}
\label{sec-tasks}
To start from somewhere the first task will be to use an already done deep learning algorithm from the research group IAM from the CVC, which is working on a framework to determine the optimal architecture for cognitive state recognition from EEG signals, with the objective to answer different questions:
\begin{itemize}
  \item How to combine the signals to create the input features for feature extraction? In this case, having 14 sensors x 5 waves, so 70 raw signals. These signals can be concatenated, or projected. As well, in case of projection, the weights can be equal or learned.
  \item Which neural network is the best performer?
  \item Is it better to ensemble the different classifiers before combining the signals?
\end{itemize}
\leavevmode\\
This framework was originally intended to study brain workload, so, within this framework, the idea is to modify it to fulfil the objective of clinic seizure detection. In this TFG, different strategies will be applied on the input data of the algorithm to further study it’s capabilities.
\\
Because in this TFG the CHB-MIT Scalp EEG Database\cite{goldberger2000physiobank} is being used and all files are in format “.edf” a first script has been needed to change the format from “.edf” to “.parquet”. This script is called “03\_ReadEDF.py”, being the first script to execute this TFG. It’s designed to extract the files from a specific folder hierarchy where all the encephalograms are classified by subjects. For simplicity this script obtains, filters, plots, and saves in parquets all input data. Datasets provided by the cvc have also been used, but the scripts used to read, filter and split data is “MainSource\_vr1.py”.
\\
In the “03\_ReadEDF.py” script there are different options on how raw data is imported, and also there are options on the way to execute them. Because during the development of this TFG many tests have been done, there are two different ways to execute the script:
\\
\begin{itemize}
  \item Single execution, where the subject number and the edf file of the subject needs to be provided to execute the script for this single file. 
  \item Multiple executions, where the number of subjects is provided. The script will go though all the first n subjects defined.
\end{itemize}
\leavevmode\\
The script will automatically label all raw data using the summary file in each subject’s folder, so it’s important for it to be present or a label execution error will pop up. The files “.edf.seizures” in every subject’s folder were unreadable, even reading the binary was a failure. The script will make sure the file has all the data from the desired electrodes, this is important because hardware problems while recording the edfs some files have gaps or lack some data, if any edf file have this problem it will automatically be excluded and the user will be notified.
\\
Filtering data is done by first setting a maximum range from 0.5hz to 50hz, and afterwards only by changing the name of a parameter it can be changed to delta, theta, alpha, beta or gamma’s range frequencies in a dictionary added by default. Everything is modular so it can be changed any time with any range of frequencies. All data is saved in “.parquet” format in a different folder named parquets in every subject’s folder, if plotting is enabled it will plot each subject’s data.
\\
\\
After all desired raw data is filtered and saved, the second script to execute is “04\_MExecution.py”, this one is in charge of the execution of the model to obtain the results classifying the data. All hyperparameters are defined at the beginning of the script, and afterword’s the module is tested with random data to ensure it’s working as expected. For each parquet it splits it’s content depending of the percentage settled in training and testing, continuing by training the model and testing.
\\

\begin{figure}[h]
  \caption{Scheme of data processing }
  \centering
  \includegraphics[width=0.5\textwidth]{img/FeatureProjectorModel.png}
\end{figure}
\leavevmode\\
During the implementation of this procedure, a lot of problems of dependency on critical libraries has happened. Starting by cuda, for faster results it is used in all models, but it might not work if the architecture of the graphics card is too old. It is also not compatible with python 3.10 which was the version being worked on at the moment, it had to be switched to an environment with python 3.8 to avoid further issues.
\\
\input{Annex.tex}


\section{Bibliography}
\label{sec-bibliography}

\printbibliography

%\section*{Agraïments}


\end{document}

